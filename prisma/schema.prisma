// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model ReadinessAssessment {
  id          String   @id @default(cuid())
  email       String
  name        String?
  organization String?
  systemType  String
  authStatus  String
  auditHistory String
  infraMaturity String
  timelinePressure String
  readinessScore String
  gapsSummary  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ContactSubmission {
  id          String   @id @default(cuid())
  name        String
  email       String
  organization String?
  phone       String?
  message     String
  createdAt   DateTime @default(now())
}

model GovernmentContractDiscovery {
  id                  String   @id @default(cuid())
  google_query        String
  service_category    String?
  title               String
  url                 String   @unique
  domain              String
  snippet             String?
  document_type       String?
  notice_id           String?
  solicitation_number String?
  agency              String?
  naics_codes         String   @default("[]") // JSON array as string
  set_aside           String   @default("[]") // JSON array as string
  location_mentions   String   @default("[]") // JSON array as string
  detected_keywords   String   @default("[]") // JSON array as string
  relevance_score     Int      @default(0)
  ingestion_status    String   @default("discovered")
  verified            Boolean  @default(false)
  verified_at         DateTime?
  verified_by         String?
  downloaded          Boolean  @default(false)
  downloaded_at       DateTime?
  proposal_generated  Boolean  @default(false)
  proposal_generated_at DateTime?
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt
  discovered_by       String?
  
  // Scraping fields
  scraped             Boolean  @default(false)
  scraped_at          DateTime?
  scraped_html_content String?  // Full HTML content of opportunity page
  scraped_text_content String? // Extracted text from HTML
  
  // SOW attachment fields
  sow_attachment_url  String?  // URL to the SOW attachment
  sow_attachment_type String?  // PDF, DOCX, etc.
  sow_attachment_content String? // Extracted text from SOW document
  sow_scraped         Boolean  @default(false)
  sow_scraped_at      DateTime?
  
  // Analysis fields
  analysis_summary    String?  // AI/heuristic analysis of the contract
  analysis_confidence Float?   // Confidence score 0-1
  analysis_keywords   String   @default("[]") // Additional keywords from analysis
  
  // AI Parsing fields
  aiParsedData        String?  // JSON string of parsed contract data
  aiParsedAt          DateTime?
  
  // AI Analysis fields
  aiSummary           String?  // AI-generated executive summary
  aiKeyRequirements   String?  // JSON array of key requirements
  aiKeywords          String?  // JSON array of AI-detected keywords
  aiStrengths         String?  // JSON array of strengths/advantages
  aiConcerns          String?  // JSON array of concerns/challenges
  aiFitScore          Float?   // 0-100 fit score for MacTech capabilities
  aiServiceCategory   String?  // cybersecurity, infrastructure, compliance, contracts, general
  aiRecommendedActions String? // JSON array of recommended actions
  aiAnalysisGeneratedAt DateTime?
  
  // AI Award Likelihood fields
  aiAwardLikelihood   Float?   // 0-100 award probability score
  aiAwardConfidence   String?  // HIGH, MEDIUM, LOW
  aiAwardReasoning    String?  // Explanation of the score
  aiAwardStrengths    String?  // JSON array of award strengths
  aiAwardConcerns     String?  // JSON array of award concerns
  aiAwardRiskFactors  String?  // JSON array of risk factors
  aiAwardRecommendations String? // JSON array of recommendations
  aiAwardLikelihoodGeneratedAt DateTime?
  
  // Dismissal fields
  dismissed           Boolean  @default(false)
  dismissed_at        DateTime?
  dismissed_by        String?
  dismissal_reason    String?
}

